global:
  image:
    tag: v2.0

serviceAccount:
  annotations:
    eks.amazonaws.com/role-arn: "arn:aws:iam::863422182520:role/ezl-app-server-dev-role"

resources:
  requests:
    cpu: 500m
  limits:
    cpu: 500m
ingress:
  enabled: true
  className: nginx
  hosts:
    - host: app-1.seungdobae.com
      path: /
      pathType: Prefix

args:
- /app/log-generator.sh

revisionHistoryLimit: 3

# Rollout 활성화
rollout:
  enabled: true
  
  strategy:
    blueGreen:
      # 자동 프로모션 (프로덕션에서는 false 권장)
      autoPromotionEnabled: false
      
      # 30초 후 이전 버전 제거
      scaleDownDelaySeconds: 30
      
      # 프리뷰 환경은 1개 파드만
      previewReplicaCount: 1
      
      # 프로모션 전 분석 활성화
      prePromotionAnalysis:
        enabled: true

  # 프리뷰 서비스 설정
  previewService:
    type: ClusterIP

  # 분석 템플릿 활성화
  analysisTemplate:
    enabled: true
    
    metrics:
      successRate:
        threshold: 0.90  # 개발환경은 90% 성공률
        count: 2
        failureLimit: 1
      
      responseTime:
        threshold: 1.0   # 1초 이하
        count: 2
        failureLimit: 1

# 레플리카 수
replicaCount: 2
