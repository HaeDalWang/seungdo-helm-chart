# 프로덕션 환경용 - 안전한 블루-그린 배포
global:
  image:
    tag: "v1.0"  # 반드시 명시적으로 지정해야 함

serviceAccount:
  annotations:
    eks.amazonaws.com/role-arn: "arn:aws:iam::863422182520:role/ezl-app-server-dev-role"

ingress:
  enabled: true
  className: nginx
  hosts:
    - host: app.seungdobae.com
      path: /
      pathType: Prefix

# Argo Rollouts 블루-그린 배포 사용
rollout:
  enabled: true
  
  strategy:
    blueGreen:
      # 수동 승인 필수 (프로덕션 안전성)
      autoPromotionEnabled: false
      
      # 5분간 이전 버전 유지 (롤백 대비)
      scaleDownDelaySeconds: 300
      
      # 프리뷰는 최소한으로
      previewReplicaCount: 1
      
      # 프로덕션에서는 분석 권장
      prePromotionAnalysis:
        enabled: false  # 필요시 true로 변경

  # 분석 템플릿 (필요시 활성화)
  analysisTemplate:
    enabled: false

# 레플리카 수
replicaCount: 5
# PDB
podDisruptionBudget:
  minAvailable: 1
# HPA 오토스케일링
autoscaling:
  enabled: true
  minReplicas: 5
  maxReplicas: 20
  triggers:
    cpu:
      enabled: true
      targetUtilization: "70"
    memory:
      enabled: true
      targetUtilization: "80"

# 리소스
resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 200m
    memory: 256Mi

# 엄격한 헬스체크
startupProbe:
  httpGet:
    path: /api/intgapp/ping/
    port: 8000
  failureThreshold: 5
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5

livenessProbe:
  httpGet:
    path: /api/intgapp/ping/
    port: 8000
  failureThreshold: 3
  periodSeconds: 30
  timeoutSeconds: 5

readinessProbe:
  httpGet:
    path: /api/intgapp/ping/
    port: 8000
  failureThreshold: 3
  periodSeconds: 10
  timeoutSeconds: 5
